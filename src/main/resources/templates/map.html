<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>MusicMap</title>

</head>
<body>
<div id="map" style="width:100%;height:350px;"></div>

<script type="text/javascript" th:src="${mapApiKey}"></script>
<script th:inline="javascript">
    var mapContainer = document.getElementById('map'),
        mapOption = {
            center: new kakao.maps.LatLng(33.450701, 126.570667),
            level: 3
        };

    var map = new kakao.maps.Map(mapContainer, mapOption);

    // 배열로 돌려야됨
    var positions = [
        {
            content: '<div>카카오</div>',
            latlng: new kakao.maps.LatLng(33.450705, 126.570677),
            removeable: false
        },
        {
            content: '<div>생태연못</div>',
            latlng: new kakao.maps.LatLng(33.450936, 126.569477),
            removeable: false
        },
        {
            content: '<div>텃밭</div>',
            latlng: new kakao.maps.LatLng(33.450879, 126.569940),
            removeable: false
        },
        {
            content: '<div>근린공원</div>',
            latlng: new kakao.maps.LatLng(33.451393, 126.570738),
            removeable: false
        }
    ];

    for (var i = 0; i < positions.length; i ++) {

        var marker = new kakao.maps.Marker({
            map: map,
            position: positions[i].latlng
        });


        var infowindow = new kakao.maps.InfoWindow({
            content: positions[i].content
        });

        kakao.maps.event.addListener(marker, 'click', makeClickListener(map, marker, infowindow, positions[i].removeable));
    }

    function makeClickListener(map, marker, infowindow, removeable) {
        return function() {
            if (!removeable) {
                infowindow.open(map, marker);
                removeable = true;
            } else {
                infowindow.close();
                removeable = false;
            }

        };
    }
</script>
</body>
</html>